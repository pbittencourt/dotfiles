#!/bin/sh

status=$(mpc current 2>/dev/null)
if [ -n "$status" ]; then
    playing=$(mpc | grep playing 2>/dev/null)
    if [ -n "$playing" ]; then
        state="Now playing"
    else
        state="Music paused"
    fi
    config_file="$HOME/.config/mpd/mpd.conf"
    music_dir=$(grep "^music_directory" $config_file | grep -o '".*"' | sed 's/"//g' 2>/dev/null)
    current_rel_dir=$(ncmpcpp --current-song="%D" 2>/dev/null)
    current_abs_dir="$music_dir/$current_rel_dir"
    cover_name=$(ls "$current_abs_dir" | grep -Ei "albumart|cover|folder|front" | head -1 2>/dev/null)
    if [ -n "$cover_name" ]; then
        cover_path="$current_abs_dir/$cover_name"
        cp -f "$cover_path" "$HOME/.tmp/albumart"
        art="$HOME/.tmp/albumart"
    else
        art="preferences-desktop-sound"
    fi
    pctime=$(mpc status "%percenttime%" | grep -o "[0-9]*")
    notify-send -u low -t 5400 -i "$art" -h "int:value:${pctime}" \
    "${state}" "<b>$(mpc --format '%title%' current)</b>\n$(mpc --format '%artist%\n%album%' current)"
fi
