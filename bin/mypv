#!/usr/bin/bash

show_help() {
    cat <<EOF
Usage $(basename "$0") [-h] <VIDEO>

Open <VIDEO> with ${bold}mpv${norm}, using ${smul}steroids${rmul}!
Works with local and remote videos.

OPTIONS:

    ${bold}-h${norm}  Show this help text and exit program.
EOF
}

COMMON="$HOME/.local/bin/common.sh"
if [[ -f "$COMMON" ]]; then
    source "$COMMON"
else
    err="❌"
    red=$(tput setaf 1)
    norm=$(tput sgr0)
    echo "${red}${err}Arquivo ${smul}$COMMON${rmul} não encontrado. O programa será encerrado.${norm}"
    exit 1
fi

MPVRECONNECT="$HOME/.local/bin/mpv-reconnect.lua"
if [[ ! -f "$MPVRECONNECT" ]]; then
    echo "${red}${err}Arquivo ${smul}$MPVRECONNECT${rmul} não encontrado."
    echo "O programa será encerrado.${norm}"
    exit 1
fi

while getopts 'hsid:r:aio:' OPTION; do
    case "$OPTION" in
        h)
            show_help
            exit
            ;;
    esac
done
shift $((OPTIND - 1))

if [[ -z "$@" ]]; then
    echo "${blue}${ale}Parâmetro ${smul}<VIDEO>${rmul} requerido!${norm}"
    show_help
    exit 1
else
    VIDEO="$@"
fi

mpv \
    --title="floating" \
    --force-window=immediate \
    --scripts-append="$MPVRECONNECT" \
    --keep-open=yes \
    --keep-open-pause=no \
    --auto-window-resize=no \
    "${VIDEO}"
